"use strict";(self.webpackChunkaudio_journal_frontend=self.webpackChunkaudio_journal_frontend||[]).push([[324],{8324:(e,t,r)=>{r.r(t),r.d(t,{default:()=>C});var s=r(5043),a=r(6446),n=r(5865),l=r(4628),i=r(8569),o=r(3845),c=r(615),d=r(1787),u=r(704),h=r(3336),m=r(6360),p=r(5271),x=r(4605),g=r(3217),j=r(1690),y=r(2643),A=r(7381),f=r(579);const S=function(e){let{startDate:t,setStartDate:r,endDate:s,setEndDate:n,hasSummary:l,setHasSummary:i,hasTranscript:o,setHasTranscript:d}=e;return(0,f.jsx)(j.$,{dateAdapter:A.h,children:(0,f.jsxs)(a.A,{sx:{display:"flex",gap:2,alignItems:"center",mb:2},children:[(0,f.jsx)(y.l,{label:"Start Date",value:t,onChange:r,renderInput:e=>(0,f.jsx)(c.A,{...e,size:"small"})}),(0,f.jsx)(y.l,{label:"End Date",value:s,onChange:n,renderInput:e=>(0,f.jsx)(c.A,{...e,size:"small"})}),(0,f.jsx)(x.A,{control:(0,f.jsx)(g.A,{checked:l,onChange:e=>i(e.target.checked)}),label:"Has Summary"}),(0,f.jsx)(x.A,{control:(0,f.jsx)(g.A,{checked:o,onChange:e=>d(e.target.checked)}),label:"Has Transcript"})]})})};var v=r(793);const b=function(e){let{tags:t,onTagClick:r}=e;const a=(0,s.useRef)();return(0,s.useEffect)((()=>{if(!t||0===t.length)return;v.Ltv(a.current).selectAll("*").remove();const e=v.Ltv(a.current).attr("width",400).attr("height",200),s=v.T9B(t,(e=>e.count))||1,n=v.m4Y().domain([1,s]).range([12,38]),l=Math.ceil(Math.sqrt(t.length)),i=Math.ceil(t.length/l),o=400/l,c=200/i;t.sort(((e,t)=>t.count-e.count)),e.selectAll("text").data(t).enter().append("text").attr("x",((e,t)=>t%l*o+o/2)).attr("y",((e,t)=>Math.floor(t/l)*c+c/2)).attr("text-anchor","middle").attr("font-size",(e=>n(e.count))).attr("fill","#1976d2").attr("style","cursor:pointer;").text((e=>e.tag)).on("click",((e,t)=>r&&r(t.tag)))}),[t,r]),(0,f.jsx)("svg",{ref:a,style:{width:"100%",height:200,display:"block",margin:"auto"}})};class w extends s.Component{constructor(e){super(e),this.state={error:null}}static getDerivedStateFromError(e){return{error:e}}componentDidCatch(e,t){console.error("EntryViewer render error:",e,t)}render(){return this.state.error?(0,f.jsx)(a.A,{sx:{p:4},children:(0,f.jsxs)(n.A,{color:"error",children:["Render error: ",this.state.error.message||String(this.state.error)]})}):this.props.children}}const C=function(){const[e,t]=(0,s.useState)([]),[r,x]=(0,s.useState)(null),[g,j]=(0,s.useState)(""),[y,A]=(0,s.useState)([]),[v,C]=(0,s.useState)(null),[D,E]=(0,s.useState)(null),[k,T]=(0,s.useState)(!1),[z,I]=(0,s.useState)(!1),[M,B]=(0,s.useState)(null);(0,s.useEffect)((()=>{(async()=>{try{const e=await window.electronAPI.listEntries();if(console.log("DEBUG: listEntries result:",e),!Array.isArray(e))return B("Failed to load entries: Malformed or missing data."),void t([]);t(e),B(null)}catch(e){B("Could not load entries."),t([]),console.error("IPC call to listEntries failed:",e)}})()}),[]);const F=Array.from(new Set(e.flatMap((e=>e.tags||[])))),H=e.flatMap((e=>e.tags||[])).reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{}),L=Object.entries(H).map((e=>{let[t,r]=e;return{tag:t,count:r}})),_=e.filter((e=>{const t=!g||e.summary&&e.summary.toLowerCase().includes(g.toLowerCase())||e.transcriptSnippet&&e.transcriptSnippet.toLowerCase().includes(g.toLowerCase())||e.date&&e.date.includes(g),r=0===y.length||e.tags&&y.every((t=>(e.tags||[]).includes(t)));let s=!0;v&&e.date&&(s=new Date(e.date)>=new Date(v)),D&&e.date&&(s=s&&new Date(e.date)<=new Date(D));const a=!k||e.summary&&""!==e.summary.trim(),n=!z||e.transcriptSnippet&&""!==e.transcriptSnippet.trim();return t&&r&&s&&a&&n}));(0,s.useEffect)((()=>{console.log("DEBUG: TagCloudData",L),console.log("DEBUG: AdvancedFilters",{startDate:v,endDate:D,hasSummary:k,hasTranscript:z})}),[L,v,D,k,z]);const G=(0,s.memo)((e=>{let{index:t,style:r,data:s}=e;const{entries:a,selected:c,handleSelect:d}=s,u=a[t];return u?(0,f.jsx)(l.Ay,{style:r,button:!0,selected:c&&c.base===u.base,onClick:()=>d(u),divider:!0,children:(0,f.jsx)(i.A,{primary:u.date||u.base||`Entry ${t+1}`,secondary:(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(n.A,{component:"span",variant:"body2",color:"text.secondary",noWrap:!0,children:u.summary&&"string"===typeof u.summary?u.summary.slice(0,100):u.transcriptSnippet&&"string"===typeof u.transcriptSnippet?u.transcriptSnippet.slice(0,100):""}),(0,f.jsx)("br",{}),(u.tags||[]).map((e=>(0,f.jsx)(o.A,{label:e,size:"small",sx:{mr:.5,mt:.5}},e)))]})})},u.base||t):null}));return(0,f.jsx)(w,{children:(0,f.jsxs)(a.A,{sx:{mt:4},children:[(0,f.jsx)(n.A,{variant:"h4",color:"primary",gutterBottom:!0,children:"Journal Entries"}),M&&(0,f.jsx)(n.A,{color:"error",sx:{mb:2},children:M}),(0,f.jsxs)(a.A,{sx:{display:"flex",gap:2,mb:2},children:[(0,f.jsx)(c.A,{variant:"outlined",size:"small",placeholder:"Search entries...",value:g,onChange:e=>j(e.target.value),InputProps:{startAdornment:(0,f.jsx)(d.A,{position:"start",children:(0,f.jsx)(m.A,{})})},sx:{flex:1}}),(0,f.jsx)(u.A,{multiple:!0,size:"small",options:F,value:y,onChange:(e,t)=>A(t),renderInput:e=>(0,f.jsx)(c.A,{...e,variant:"outlined",placeholder:"Filter by tag"}),sx:{minWidth:200}}),S?(0,f.jsx)(S,{startDate:v,setStartDate:C,endDate:D,setEndDate:E,hasSummary:k,setHasSummary:T,hasTranscript:z,setHasTranscript:I}):(0,f.jsx)(n.A,{color:"error",children:"AdvancedFilters missing"})]}),(0,f.jsxs)(a.A,{sx:{mb:2},children:[(0,f.jsx)(n.A,{variant:"subtitle1",color:"secondary",children:"Tag Cloud"}),b?(0,f.jsx)(b,{tags:L,onTagClick:e=>{y.includes(e)||A([...y,e])}}):(0,f.jsx)(n.A,{color:"error",children:"TagCloud missing"})]}),(0,f.jsx)(h.A,{elevation:2,sx:{height:400,width:"100%",overflow:"hidden",mb:2},children:0===_.length?(0,f.jsx)(l.Ay,{children:(0,f.jsx)(i.A,{primary:"No entries found."})}):(0,f.jsx)(p.Y1,{height:400,itemCount:_.length,itemSize:90,width:"100%",itemData:{entries:_,selected:r,handleSelect:e=>x(e)},children:G})}),r&&(0,f.jsxs)(h.A,{elevation:3,sx:{p:3},children:[(0,f.jsx)(n.A,{variant:"h5",color:"secondary",gutterBottom:!0,children:r.date||r.base||"Entry"}),r.audio&&(0,f.jsx)("audio",{controls:!0,src:`file://${r.audio}`,style:{width:"100%"}}),(0,f.jsx)(n.A,{variant:"subtitle1",sx:{mt:2},children:"Summary:"}),(0,f.jsx)(n.A,{variant:"body1",children:r.summary||"No summary available."}),(0,f.jsx)(n.A,{variant:"subtitle1",sx:{mt:2},children:"Transcript:"}),(0,f.jsx)(n.A,{variant:"body2",sx:{whiteSpace:"pre-wrap"},children:r.transcriptSnippet||"No transcript available."}),(0,f.jsx)(a.A,{sx:{mt:2},children:(r.tags||[]).map((e=>(0,f.jsx)(o.A,{label:e,size:"small",sx:{mr:.5}},e)))})]})]})})}}}]);
//# sourceMappingURL=324.a709766c.chunk.js.map